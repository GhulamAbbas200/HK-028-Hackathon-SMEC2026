<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CampusFlow | Resource Management</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.0/umd/lucide.min.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --bg-light: #f8fafc;
            --sidebar: #1e293b;
            --text-main: #334155;
            --white: #ffffff;
            --border: #e2e8f0;
            --success: #22c55e;
            --danger: #ef4444;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', system-ui, sans-serif; }
        body { background-color: var(--bg-light); color: var(--text-main); display: flex; min-height: 100vh; }

        /* Sidebar */
        nav { width: 260px; background: var(--sidebar); color: white; padding: 2rem 1rem; position: fixed; height: 100vh; }
        .logo { font-size: 1.5rem; font-weight: 800; margin-bottom: 2rem; color: #60a5fa; display: flex; align-items: center; gap: 10px; }
        .nav-item { padding: 0.75rem 1rem; border-radius: 8px; cursor: pointer; transition: 0.2s; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 12px; }
        .nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.1); }

        /* Main Content */
        main { flex: 1; margin-left: 260px; padding: 2rem; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }

        /* Catalog UI */
        .search-bar { background: white; border: 1px solid var(--border); padding: 0.75rem 1rem; border-radius: 10px; width: 350px; display: flex; align-items: center; gap: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .search-bar input { border: none; outline: none; width: 100%; font-size: 0.9rem; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; }
        
        .card { background: white; border-radius: 12px; padding: 1.5rem; border: 1px solid var(--border); transition: 0.2s; }
        .card:hover { transform: translateY(-3px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        
        .tag { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 700; color: #64748b; margin-bottom: 0.5rem; display: block; }

        /* Buttons */
        .btn { padding: 0.7rem 1.2rem; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; transition: 0.2s; width: 100%; font-size: 0.9rem; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }

        /* Modal */
        #bookingModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(4px); }
        .modal-content { background: white; padding: 2rem; border-radius: 16px; width: 450px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.2); }
        input, select { width: 100%; padding: 0.8rem; margin: 0.5rem 0 1.2rem; border: 1px solid var(--border); border-radius: 8px; font-size: 1rem; }

        /* Admin Dashboard */
        .admin-table { width: 100%; background: white; border-collapse: collapse; border-radius: 12px; overflow: hidden; border: 1px solid var(--border); }
        .admin-table th { background: #f8fafc; padding: 1rem; text-align: left; font-size: 0.85rem; color: #64748b; }
        .admin-table td { padding: 1rem; border-bottom: 1px solid var(--border); }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<nav>
    <div class="logo"><i data-lucide="shield-check"></i> CampusFlow</div>
    <div class="nav-item active" id="nav-catalog" onclick="showView('catalog')"><i data-lucide="grid"></i> Catalog</div>
    <div class="nav-item" id="nav-admin" onclick="showView('admin')"><i data-lucide="calendar-check"></i> Admin Dashboard</div>
</nav>

<main>
    <div id="catalog-view">
        <div class="header">
            <h1>Resource Catalog</h1>
            <div class="search-bar">
                <i data-lucide="search" size="18"></i>
                <input type="text" id="searchInput" placeholder="Search labs, halls, equipment..." onkeyup="filterResources()">
            </div>
        </div>
        <div class="grid" id="resourceGrid"></div>
    </div>

    <div id="admin-view" class="hidden">
        <div class="header">
            <h1>Pending Approval Queue</h1>
        </div>
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Resource</th>
                    <th>Requester</th>
                    <th>Date & Slot</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="adminTableBody"></tbody>
        </table>
    </div>
</main>

<div id="bookingModal">
    <div class="modal-content">
        <h2 id="modalTitle" style="margin-bottom: 5px;">Book Resource</h2>
        <p style="color: #64748b; margin-bottom: 20px;">Check availability for specific dates.</p>
        
        <label>Pick a Date</label>
        <input type="date" id="bookDate" min="">

        <label>Choose Time Slot</label>
        <select id="bookTime">
            <option value="Morning (09:00 - 12:00)">Morning (09:00 - 12:00)</option>
            <option value="Afternoon (13:00 - 16:00)">Afternoon (13:00 - 16:00)</option>
            <option value="Evening (17:00 - 20:00)">Evening (17:00 - 20:00)</option>
        </select>

        <div style="display: flex; gap: 12px; margin-top: 10px;">
            <button class="btn btn-primary" onclick="confirmBooking()">Check & Request</button>
            <button class="btn" style="background: #f1f5f9; color: #475569;" onclick="closeModal()">Cancel</button>
        </div>
    </div>
</div>

<script>
    // Data Structure
    const resources = [
        { id: 1, name: "Physics Lab A", type: "Lab" },
        { id: 2, name: "Main Auditorium", type: "Hall" },
        { id: 3, name: "4K Projector X1", type: "Equipment" },
        { id: 4, name: "Computer Lab 4", type: "Lab" },
        { id: 5, name: "Chemistry Lab", type: "Lab" },
        { id: 6, name: "Seminar Room 102", type: "Hall" }
    ];

    // Array of existing/approved bookings (Backend simulation)
    let bookings = [
        // Example: Physics Lab is already booked for tomorrow morning
        { id: 101, resId: 1, date: "2024-05-20", time: "Morning (09:00 - 12:00)", user: "Prof. Smith", status: "Approved" }
    ];

    let activeResId = null;

    // Set minimum date to today
    document.getElementById('bookDate').min = new Date().toISOString().split("T")[0];

    function renderCatalog(data = resources) {
        const grid = document.getElementById('resourceGrid');
        grid.innerHTML = data.map(res => `
            <div class="card">
                <span class="tag">${res.type}</span>
                <h3 style="margin-bottom: 1.5rem; font-size: 1.25rem;">${res.name}</h3>
                <button class="btn btn-primary" onclick="openBooking(${res.id})">Book Now</button>
            </div>
        `).join('');
        lucide.createIcons();
    }

    function filterResources() {
        const val = document.getElementById('searchInput').value.toLowerCase();
        const filtered = resources.filter(r => r.name.toLowerCase().includes(val) || r.type.toLowerCase().includes(val));
        renderCatalog(filtered);
    }

    function showView(view) {
        document.getElementById('catalog-view').classList.toggle('hidden', view !== 'catalog');
        document.getElementById('admin-view').classList.toggle('hidden', view !== 'admin');
        document.getElementById('nav-catalog').classList.toggle('active', view === 'catalog');
        document.getElementById('nav-admin').classList.toggle('active', view === 'admin');
        if(view === 'admin') renderAdmin();
    }

    // Modal Controls
    function openBooking(id) {
        activeResId = id;
        const res = resources.find(r => r.id === id);
        document.getElementById('modalTitle').innerText = res.name;
        document.getElementById('bookingModal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('bookingModal').style.display = 'none';
    }

    // BACKEND VALIDATION LOGIC
    function confirmBooking() {
        const date = document.getElementById('bookDate').value;
        const time = document.getElementById('bookTime').value;

        if(!date) return alert("Please select a date.");

        // Check if this specific resource is already taken on this specific date/time
        const isTaken = bookings.find(b => 
            b.resId === activeResId && 
            b.date === date && 
            b.time === time &&
            b.status !== "Declined"
        );

        if(isTaken) {
            alert(`⚠️ CONFLICT: This resource is already booked for ${time} on ${date}. Please choose another slot.`);
            return;
        }

        // If not taken, add to pending list
        const res = resources.find(r => r.id === activeResId);
        bookings.push({
            id: Date.now(),
            resId: activeResId,
            resName: res.name,
            user: "Student User",
            date: date,
            time: time,
            status: "Pending"
        });

        alert("✅ Booking Request Sent! You will be notified once the Admin approves.");
        closeModal();
    }

    function renderAdmin() {
        const tbody = document.getElementById('adminTableBody');
        tbody.innerHTML = bookings.map(b => `
            <tr>
                <td><strong>${b.resName || resources.find(r=>r.id===b.resId).name}</strong></td>
                <td>${b.user}</td>
                <td>${b.date} <br><small>${b.time}</small></td>
                <td><span style="color: ${b.status === 'Approved' ? 'var(--success)' : (b.status === 'Pending' ? '#f59e0b' : 'var(--danger)')}; font-weight: 600;">${b.status}</span></td>
                <td>
                    ${b.status === 'Pending' ? `
                        <button class="btn" style="width: auto; padding: 4px 8px; background: var(--success); color: white;" onclick="updateStatus(${b.id}, 'Approved')">Approve</button>
                        <button class="btn" style="width: auto; padding: 4px 8px; background: var(--danger); color: white;" onclick="updateStatus(${b.id}, 'Declined')">Decline</button>
                    ` : '--'}
                </td>
            </tr>
        `).join('') || '<tr><td colspan="5" style="text-align:center; padding: 2rem; color: #94a3b8;">No activity found</td></tr>';
    }

    function updateStatus(id, newStatus) {
        const booking = bookings.find(b => b.id === id);
        booking.status = newStatus;
        alert(`Notification: User has been sent an ${newStatus === 'Approved' ? 'Email' : 'SMS'} regarding this update.`);
        renderAdmin();
    }

    // Init
    renderCatalog();
    lucide.createIcons();
</script>

</body>
</html>